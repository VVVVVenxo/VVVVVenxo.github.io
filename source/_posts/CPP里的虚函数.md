---
title: C++中的虚函数
toc: true
tag: C++
---
### C++中的多态
- 多态是面向对象编程的三大原则之一（封装、继承、多态）。
- 所谓多态，就是同一个函数名具有多种状态，或者说一个接口具有不同的行为。
- C++的多态分为**编译时多态**和**运行时多态**.
- 编译时多态也称为为**静态联编**，通过重载和模板来实现；运行时多态称为**动态联编**，通过继承和虚函数来实现。

***

### 虚函数的实现机制
- 虚函数是通过**虚函数表**来实现的，虚函数表包含了一个类（所有）的虚函数的地址。
- 在有虚函数的类对象中，它内存空间的头部会有一个**虚函数表指针**（虚表指针），用来管理虚函数表。
- 当子类对象对父类虚函数进行重写的时候，虚函数表的相应虚函数地址会发生改变，改写成这个虚函数的地址，当我们用一个父类的指针来操作子类对象的时候，它可以指明实际所调用的函数。

***

### 虚函数的特质
- 虚函数存在于类中，不同的类对象共享一张虚函数表（为了节省内存空间）。

*** 

### 在C中实现虚函数
- 需要做的工作：手动构造父子关系、创建虚函数表、设置虚表指针并指向虚函数表、填充虚函数表；当虚函数重写的时候还需要手动修改函数指针等等。